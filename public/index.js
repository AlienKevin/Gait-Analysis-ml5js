let video,poseNet;swal({title:"Loading...",text:"Please wait",icon:"/assets/spinner.gif",button:!1,closeOnClickOutside:!1,closeOnEsc:!1});let poses=[],warnings=!1,angles=[],plot=new Chart(document.getElementById("plot").getContext("2d"),{type:"line",data:{datasets:[{label:"Left Elbow",backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"green",data:[]}]},options:{scales:{xAxes:[{type:"linear",position:"bottom"}]}}});function setup(){let e=createCanvas(2*windowHeight/3,windowHeight/2),t=(windowWidth-width)/2;e.position(t,10),video=createCapture(VIDEO),video.size(width,height),poseNet=ml5.poseNet(video,{imageScaleFactor:.3,outputStride:16,flipHorizontal:!1,minConfidence:.5,scoreThreshold:.5,nmsRadius:20,detectionType:"single",multiplier:.75},modelReady),poseNet.on("pose",(function(e){if(poses=e,warnings=!1,poses.length>0){const e=poses[0].pose;if(e.score>=.2){const t=e.keypoints;const[o,n,i,s,l,a,r,g,p,d,h,c]=["leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"].map((function(e){const o=t.filter(t=>t.part===e)[0];if(!(o.score<.1))return o.position;warnings=!0}));warnings||(angles.push({leftElbow:getAngle(o,i,l),rightElbow:getAngle(n,s,a),leftKnee:getAngle(r,p,h),rightKnee:getAngle(g,d,c)}),addAnglesToPlot())}}})),video.hide()}function getAngle(e,t,o){return toDegrees(Math.atan(Math.abs((t.y-e.y)/(t.x-e.x))))+toDegrees(Math.atan(Math.abs((o.y-t.y)/(o.x-t.x))))}function toDegrees(e){return e*(180/Math.PI)}function modelReady(){swal.close()}function draw(){image(video,0,0,width,height),warnings?swal("Please make sure that all your body parts are in the view of the camera.",{icon:"warning",buttons:!1,timer:200}):(drawKeypoints(),drawSkeleton())}function addAnglesToPlot(){const e=angles[angles.length-1];let t=plot.data.datasets[0].data.length;plot.data.datasets[0].data.push({x:t,y:e.leftElbow}),plot.update()}function drawKeypoints(){for(let e=0;e<poses.length;e++){let t=poses[e].pose;for(let e=0;e<t.keypoints.length;e++){let o=t.keypoints[e];o.score>.2&&(fill(255,0,0),noStroke(),ellipse(o.position.x,o.position.y,10,10))}}}function drawSkeleton(){for(let e=0;e<poses.length;e++){let t=poses[e].skeleton;for(let e=0;e<t.length;e++){let o=t[e][0],n=t[e][1];stroke(255,0,0),line(o.position.x,o.position.y,n.position.x,n.position.y)}}}